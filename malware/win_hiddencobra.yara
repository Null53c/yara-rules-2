rule hiddencobra__rc4_stack_key_fallchill
{
  meta:
    description = "rc4_stack_key"
  strings:
    $stack_key = { 0d 06 09 2a ?? ?? ?? ?? 86 48 86 f7 ?? ?? ?? ?? 0d 01 01 01 ?? ?? ?? ?? 05 00 03 82 41 8b c9 41 8b d1 49 8b 40 08 48 ff c2 88 4c 02 ff ff c1 81 f9 00 01 00 00 7c eb }
  condition:
    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $stack_key
}



rule hiddencobra__success_fail_codes_fallchill
{
  meta:
    description = "success_fail_codes"
  strings:
    $s0 = { 68 7a 34 12 00 }  
    $s1 = { ba 7a 34 12 00 }  
    $f0 = { 68 5c 34 12 00 }  
    $f1 = { ba 5c 34 12 00 }
  condition:
    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and (($s0 and $f0) or ($s1 and $f1))
}



rule hiddencobra__xor_ip
{
  meta:
    description = "hidden cobra: XOR used for IP"
  strings:
    $s0 = { 53 3a 9c 57 }  
    $s1 = { 57 9c 3a 53 }
  condition:
    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) 
    and any of them
}



rule hiddencobra__Malware_Updater { 
   meta:
       Author="US-CERT Code Analysis Team"
       Date="2017/08/02"
       Incident="10132963"
       MD5_1="8F4FC2E10B6EC15A01E0AF24529040DD"
       MD5_2="584AC94142F0B7C0DF3D0ADDE6E661ED"
       Info="Malware may be used to update multiple systems with secondary payloads"
       super_rule=1
   strings:
       $s0 = { 8A4C040480F15D80C171884C04044083F8107CEC } 
       $s1 = { 8A4D0080F19580E97C884D00454B75F0 }
   condition: 
       any of them
}



rule hiddencobra__volgmer
{
  meta:
    description = "Malformed User Agent"
  strings:
    $s = "Mozillar/"
  condition:
    (uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and $s
}

